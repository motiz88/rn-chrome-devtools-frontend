{"version":3,"file":"TimelineEventOverview.js","sourceRoot":"","sources":["../../../../../../front_end/panels/timeline/TimelineEventOverview.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n * Copyright (C) 2013 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as TimelineModel from '../../models/timeline_model/timeline_model.js';\nimport * as TraceEngine from '../../models/trace/trace.js';\nimport * as PerfUI from '../../ui/legacy/components/perf_ui/perf_ui.js';\nimport * as UI from '../../ui/legacy/legacy.js';\n\nimport {type PerformanceModel} from './PerformanceModel.js';\n\nimport {TimelineUIUtils, type TimelineCategory} from './TimelineUIUtils.js';\n\nconst UIStrings = {\n  /**\n   *@description Short for Network. Label for the network requests section of the Performance panel.\n   */\n  net: 'NET',\n  /**\n   *@description Text in Timeline Event Overview of the Performance panel\n   */\n  cpu: 'CPU',\n  /**\n   *@description Text in Timeline Event Overview of the Performance panel\n   */\n  heap: 'HEAP',\n  /**\n   *@description Heap size label text content in Timeline Event Overview of the Performance panel\n   *@example {10 MB} PH1\n   *@example {30 MB} PH2\n   */\n  sSDash: '{PH1} – {PH2}',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/timeline/TimelineEventOverview.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nexport abstract class TimelineEventOverview extends PerfUI.TimelineOverviewPane.TimelineOverviewBase {\n  protected model: PerformanceModel|null;\n  constructor(id: string, title: string|null) {\n    super();\n    this.element.id = 'timeline-overview-' + id;\n    this.element.classList.add('overview-strip');\n    this.model = null;\n    if (title) {\n      this.element.createChild('div', 'timeline-overview-strip-title').textContent = title;\n    }\n  }\n\n  setModel(model: PerformanceModel|null): void {\n    this.model = model;\n  }\n\n  renderBar(begin: number, end: number, position: number, height: number, color: string): void {\n    const x = begin;\n    const width = end - begin;\n    const ctx = this.context();\n    ctx.fillStyle = color;\n    ctx.fillRect(x, position, width, height);\n  }\n}\n\nconst HIGH_NETWORK_PRIORITIES = new Set<TraceEngine.Types.TraceEvents.Priority>([\n  'VeryHigh',\n  'High',\n  'Medium',\n]);\n\nexport class TimelineEventOverviewNetwork extends TimelineEventOverview {\n  #traceParsedData: TraceEngine.Handlers.Migration.PartialTraceData;\n  constructor(traceParsedData: TraceEngine.Handlers.Migration.PartialTraceData) {\n    super('network', i18nString(UIStrings.net));\n    this.#traceParsedData = traceParsedData;\n  }\n\n  override update(): void {\n    super.update();\n    this.#renderWithTraceParsedData();\n  }\n\n  #renderWithTraceParsedData(): void {\n    if (!this.#traceParsedData) {\n      return;\n    }\n\n    // Because the UI is in milliseconds, we work with milliseconds through\n    // this function to get the right scale and sizing\n    const traceBoundsMilli = TraceEngine.Helpers.Timing.traceBoundsMilliseconds(this.#traceParsedData.Meta.traceBounds);\n\n    // We draw two paths, so each can take up half the height\n    const pathHeight = this.height() / 2;\n\n    const canvasWidth = this.width();\n    const scale = canvasWidth / traceBoundsMilli.range;\n\n    // We draw network requests in two chunks:\n    // Requests with a priority of Medium or higher go onto the first path\n    // Other requests go onto the second path.\n    const highPath = new Path2D();\n    const lowPath = new Path2D();\n\n    for (const request of this.#traceParsedData.NetworkRequests.byTime) {\n      const path = HIGH_NETWORK_PRIORITIES.has(request.args.data.priority) ? highPath : lowPath;\n      const {startTime, endTime} = TraceEngine.Helpers.Timing.eventTimingsMilliSeconds(request);\n      const rectStart = Math.max(Math.floor((startTime - traceBoundsMilli.min) * scale), 0);\n      const rectEnd = Math.min(Math.ceil((endTime - traceBoundsMilli.min) * scale + 1), canvasWidth);\n\n      path.rect(rectStart, 0, rectEnd - rectStart, pathHeight - 1);\n    }\n\n    const ctx = this.context();\n    ctx.save();\n    // Draw the high path onto the canvas.\n    ctx.fillStyle = 'hsl(214, 60%, 60%)';\n    ctx.fill(highPath);\n    // Now jump down by the height of the high path, and then draw the low path.\n    ctx.translate(0, pathHeight);\n    ctx.fillStyle = 'hsl(214, 80%, 80%)';\n    ctx.fill(lowPath);\n    ctx.restore();\n  }\n}\n\nconst categoryToIndex = new WeakMap<TimelineCategory, number>();\n\nexport class TimelineEventOverviewCPUActivity extends TimelineEventOverview {\n  private backgroundCanvas: HTMLCanvasElement;\n  constructor() {\n    super('cpu-activity', i18nString(UIStrings.cpu));\n    this.backgroundCanvas = (this.element.createChild('canvas', 'fill background') as HTMLCanvasElement);\n  }\n\n  override resetCanvas(): void {\n    super.resetCanvas();\n    this.backgroundCanvas.width = this.element.clientWidth * window.devicePixelRatio;\n    this.backgroundCanvas.height = this.element.clientHeight * window.devicePixelRatio;\n  }\n\n  override update(): void {\n    super.update();\n    if (!this.model) {\n      return;\n    }\n    const timelineModel = this.model.timelineModel();\n    const quantSizePx = 4 * window.devicePixelRatio;\n    const width = this.width();\n    const height = this.height();\n    const baseLine = height;\n    const timeOffset = timelineModel.minimumRecordTime();\n    const timeSpan = timelineModel.maximumRecordTime() - timeOffset;\n    const scale = width / timeSpan;\n    const quantTime = quantSizePx / scale;\n    const categories = TimelineUIUtils.categories();\n    const categoryOrder = TimelineUIUtils.getTimelineMainEventCategories();\n    const otherIndex = categoryOrder.indexOf('other');\n    const idleIndex = 0;\n    console.assert(idleIndex === categoryOrder.indexOf('idle'));\n    for (let i = 0; i < categoryOrder.length; ++i) {\n      categoryToIndex.set(categories[categoryOrder[i]], i);\n    }\n\n    const backgroundContext = (this.backgroundCanvas.getContext('2d') as CanvasRenderingContext2D | null);\n    if (!backgroundContext) {\n      throw new Error('Could not find 2d canvas');\n    }\n    for (const track of timelineModel.tracks()) {\n      if (track.type === TimelineModel.TimelineModel.TrackType.MainThread && track.forMainFrame) {\n        drawThreadEvents(this.context(), track.events);\n      } else {\n        drawThreadEvents(backgroundContext, track.events);\n      }\n    }\n    applyPattern(backgroundContext);\n\n    function drawThreadEvents(ctx: CanvasRenderingContext2D, events: TraceEngine.Legacy.Event[]): void {\n      const quantizer = new Quantizer(timeOffset, quantTime, drawSample);\n      let x = 0;\n      const categoryIndexStack: number[] = [];\n      const paths: Path2D[] = [];\n      const lastY: number[] = [];\n      for (let i = 0; i < categoryOrder.length; ++i) {\n        paths[i] = new Path2D();\n        paths[i].moveTo(0, height);\n        lastY[i] = height;\n      }\n\n      function drawSample(counters: number[]): void {\n        let y = baseLine;\n        for (let i = idleIndex + 1; i < categoryOrder.length; ++i) {\n          const h = (counters[i] || 0) / quantTime * height;\n          y -= h;\n          paths[i].bezierCurveTo(x, lastY[i], x, y, x + quantSizePx / 2, y);\n          lastY[i] = y;\n        }\n        x += quantSizePx;\n      }\n\n      function onEventStart(e: TraceEngine.Legacy.CompatibleTraceEvent): void {\n        const {startTime} = TraceEngine.Legacy.timesForEventInMilliseconds(e);\n        const index = categoryIndexStack.length ? categoryIndexStack[categoryIndexStack.length - 1] : idleIndex;\n        quantizer.appendInterval(startTime, (index as number));\n        const categoryIndex = categoryToIndex.get(TimelineUIUtils.eventStyle(e).category);\n        if (categoryIndex === idleIndex) {\n          // Idle event won't show in CPU activity, so just skip them.\n          return;\n        }\n        categoryIndexStack.push(categoryIndex !== undefined ? categoryIndex : otherIndex);\n      }\n\n      function onEventEnd(e: TraceEngine.Legacy.CompatibleTraceEvent): void {\n        const {endTime} = TraceEngine.Legacy.timesForEventInMilliseconds(e);\n        const lastCategoryIndex = categoryIndexStack.pop();\n        if (endTime !== undefined && lastCategoryIndex) {\n          quantizer.appendInterval(endTime, lastCategoryIndex);\n        }\n      }\n\n      TimelineModel.TimelineModel.TimelineModelImpl.forEachEvent(events, onEventStart, onEventEnd);\n      quantizer.appendInterval(timeOffset + timeSpan + quantTime, idleIndex);  // Kick drawing the last bucket.\n      for (let i = categoryOrder.length - 1; i > 0; --i) {\n        paths[i].lineTo(width, height);\n        ctx.fillStyle = categories[categoryOrder[i]].color;\n        ctx.fill(paths[i]);\n      }\n    }\n\n    function applyPattern(ctx: CanvasRenderingContext2D): void {\n      const step = 4 * window.devicePixelRatio;\n      ctx.save();\n      ctx.lineWidth = step / Math.sqrt(8);\n      for (let x = 0.5; x < width + height; x += step) {\n        ctx.moveTo(x, 0);\n        ctx.lineTo(x - height, height);\n      }\n      ctx.globalCompositeOperation = 'destination-out';\n      ctx.stroke();\n      ctx.restore();\n    }\n  }\n}\n\nexport class TimelineEventOverviewResponsiveness extends TimelineEventOverview {\n  // WIP as part of crbug.com/1464206\n  // eslint-disable-next-line no-unused-private-class-members\n  #traceParsedData: TraceEngine.Handlers.Migration.PartialTraceData;\n  constructor(traceParsedData: TraceEngine.Handlers.Migration.PartialTraceData) {\n    super('responsiveness', null);\n    this.#traceParsedData = traceParsedData;\n  }\n\n  override update(): void {\n    super.update();\n    if (!this.model) {\n      return;\n    }\n    const height = this.height();\n\n    const timeOffset = this.model.timelineModel().minimumRecordTime();\n    const timeSpan = this.model.timelineModel().maximumRecordTime() - timeOffset;\n    const scale = this.width() / timeSpan;\n    const ctx = this.context();\n    const fillPath = new Path2D();\n    const markersPath = new Path2D();\n\n    for (const track of this.model.timelineModel().tracks()) {\n      const events = track.events;\n      for (let i = 0; i < events.length; ++i) {\n        if (!TimelineModel.TimelineModel.EventOnTimelineData.forEvent(events[i]).warning) {\n          continue;\n        }\n        const duration = events[i].duration;\n        if (duration !== undefined) {\n          paintWarningDecoration(events[i].startTime, duration);\n        }\n      }\n    }\n\n    ctx.fillStyle = 'hsl(0, 80%, 90%)';\n    ctx.strokeStyle = 'red';\n    ctx.lineWidth = 2 * window.devicePixelRatio;\n    ctx.fill(fillPath);\n    ctx.stroke(markersPath);\n\n    function paintWarningDecoration(time: number, duration: number): void {\n      const x = Math.round(scale * (time - timeOffset));\n      const w = Math.round(scale * duration);\n      fillPath.rect(x, 0, w, height);\n      markersPath.moveTo(x + w, 0);\n      markersPath.lineTo(x + w, height);\n    }\n  }\n}\n\nexport class TimelineFilmStripOverview extends TimelineEventOverview {\n  private frameToImagePromise: Map<TraceEngine.Extras.FilmStrip.Frame, Promise<HTMLImageElement>>;\n  private lastFrame: TraceEngine.Extras.FilmStrip.Frame|null = null;\n  private lastElement: Element|null;\n  private drawGeneration?: symbol;\n  private emptyImage?: HTMLImageElement;\n  #filmStrip: TraceEngine.Extras.FilmStrip.Data|null = null;\n\n  constructor(filmStrip: TraceEngine.Extras.FilmStrip.Data) {\n    super('filmstrip', null);\n    this.frameToImagePromise = new Map();\n    this.#filmStrip = filmStrip;\n    this.lastFrame = null;\n    this.lastElement = null;\n    this.reset();\n  }\n\n  override update(): void {\n    super.update();\n    const frames = this.#filmStrip ? this.#filmStrip.frames : [];\n    if (!frames.length) {\n      return;\n    }\n\n    if (this.height() === 0) {\n      // Height of 0 causes the maths below to get off and generate very large\n      // negative numbers that cause an extremely long loop when attempting to\n      // draw images by frame. Rather than that, let's warn and exist early.\n      console.warn('TimelineFilmStrip could not be drawn as its canvas height is 0');\n      return;\n    }\n\n    const drawGeneration = Symbol('drawGeneration');\n    this.drawGeneration = drawGeneration;\n    void this.imageByFrame(frames[0]).then(image => {\n      if (this.drawGeneration !== drawGeneration) {\n        return;\n      }\n      if (!image || !image.naturalWidth || !image.naturalHeight) {\n        return;\n      }\n      const imageHeight = this.height() - 2 * TimelineFilmStripOverview.Padding;\n      const imageWidth = Math.ceil(imageHeight * image.naturalWidth / image.naturalHeight);\n      const popoverScale = Math.min(200 / image.naturalWidth, 1);\n      this.emptyImage = new Image(image.naturalWidth * popoverScale, image.naturalHeight * popoverScale);\n      this.drawFrames(imageWidth, imageHeight);\n    });\n  }\n\n  private async imageByFrame(frame: TraceEngine.Extras.FilmStrip.Frame): Promise<HTMLImageElement|null> {\n    let imagePromise: Promise<HTMLImageElement|null>|undefined = this.frameToImagePromise.get(frame);\n    if (!imagePromise) {\n      const data = frame.screenshotAsString;\n      imagePromise = UI.UIUtils.loadImageFromData(data);\n      this.frameToImagePromise.set(frame, (imagePromise as Promise<HTMLImageElement>));\n    }\n    return imagePromise;\n  }\n\n  private drawFrames(imageWidth: number, imageHeight: number): void {\n    if (!imageWidth) {\n      return;\n    }\n    if (!this.#filmStrip || this.#filmStrip.frames.length < 1) {\n      return;\n    }\n    const padding = TimelineFilmStripOverview.Padding;\n    const width = this.width();\n    const zeroTime = TraceEngine.Helpers.Timing.microSecondsToMilliseconds(this.#filmStrip.zeroTime);\n    const spanTime = TraceEngine.Helpers.Timing.microSecondsToMilliseconds(this.#filmStrip.spanTime);\n    const scale = spanTime / width;\n    const context = this.context();\n    const drawGeneration = this.drawGeneration;\n\n    context.beginPath();\n    for (let x = padding; x < width; x += imageWidth + 2 * padding) {\n      const time = TraceEngine.Types.Timing.MilliSeconds(zeroTime + (x + imageWidth / 2) * scale);\n      const timeMicroSeconds = TraceEngine.Helpers.Timing.millisecondsToMicroseconds(time);\n      const frame = TraceEngine.Extras.FilmStrip.frameClosestToTimestamp(this.#filmStrip, timeMicroSeconds);\n      if (!frame) {\n        continue;\n      }\n      context.rect(x - 0.5, 0.5, imageWidth + 1, imageHeight + 1);\n      void this.imageByFrame(frame).then(drawFrameImage.bind(this, x));\n    }\n    context.strokeStyle = '#ddd';\n    context.stroke();\n\n    function drawFrameImage(this: TimelineFilmStripOverview, x: number, image: HTMLImageElement|null): void {\n      // Ignore draws deferred from a previous update call.\n      if (this.drawGeneration !== drawGeneration || !image) {\n        return;\n      }\n      context.drawImage(image, x, 1, imageWidth, imageHeight);\n    }\n  }\n\n  override async overviewInfoPromise(x: number): Promise<Element|null> {\n    if (!this.#filmStrip || this.#filmStrip.frames.length === 0) {\n      return null;\n    }\n\n    const calculator = this.calculator();\n    if (!calculator) {\n      return null;\n    }\n    const timeMilliSeconds = TraceEngine.Types.Timing.MilliSeconds(calculator.positionToTime(x));\n    const timeMicroSeconds = TraceEngine.Helpers.Timing.millisecondsToMicroseconds(timeMilliSeconds);\n    const frame = TraceEngine.Extras.FilmStrip.frameClosestToTimestamp(this.#filmStrip, timeMicroSeconds);\n    if (frame === this.lastFrame) {\n      return this.lastElement;\n    }\n    const imagePromise = frame ? this.imageByFrame(frame) : Promise.resolve(this.emptyImage);\n    const image = await imagePromise;\n    const element = document.createElement('div');\n    element.classList.add('frame');\n    if (image) {\n      element.createChild('div', 'thumbnail').appendChild(image);\n    }\n    this.lastFrame = frame;\n    this.lastElement = element;\n    return element;\n  }\n\n  override reset(): void {\n    this.lastFrame = null;\n    this.lastElement = null;\n    this.frameToImagePromise = new Map();\n  }\n\n  // TODO(crbug.com/1172300) Ignored during the jsdoc to ts migration\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  static readonly Padding = 2;\n}\n\nexport class TimelineEventOverviewMemory extends TimelineEventOverview {\n  private heapSizeLabel: HTMLElement;\n  constructor() {\n    super('memory', i18nString(UIStrings.heap));\n    this.heapSizeLabel = this.element.createChild('div', 'memory-graph-label');\n  }\n\n  resetHeapSizeLabels(): void {\n    this.heapSizeLabel.textContent = '';\n  }\n\n  override update(): void {\n    super.update();\n    const ratio = window.devicePixelRatio;\n\n    if (!this.model) {\n      this.resetHeapSizeLabels();\n      return;\n    }\n\n    const tracks = this.model.timelineModel().tracks().filter(\n        track => track.type === TimelineModel.TimelineModel.TrackType.MainThread && track.forMainFrame);\n    const trackEvents = tracks.map(track => track.events);\n\n    const lowerOffset = 3 * ratio;\n    let maxUsedHeapSize = 0;\n    let minUsedHeapSize = 100000000000;\n    const minTime = this.model.timelineModel().minimumRecordTime();\n    const maxTime = this.model.timelineModel().maximumRecordTime();\n\n    function isUpdateCountersEvent(event: TraceEngine.Legacy.Event): boolean {\n      return event.name === TimelineModel.TimelineModel.RecordType.UpdateCounters;\n    }\n    for (let i = 0; i < trackEvents.length; i++) {\n      trackEvents[i] = trackEvents[i].filter(isUpdateCountersEvent);\n    }\n\n    function calculateMinMaxSizes(event: TraceEngine.Legacy.Event): void {\n      const counters = event.args.data;\n      if (!counters || !counters.jsHeapSizeUsed) {\n        return;\n      }\n      maxUsedHeapSize = Math.max(maxUsedHeapSize, counters.jsHeapSizeUsed);\n      minUsedHeapSize = Math.min(minUsedHeapSize, counters.jsHeapSizeUsed);\n    }\n    for (let i = 0; i < trackEvents.length; i++) {\n      trackEvents[i].forEach(calculateMinMaxSizes);\n    }\n    minUsedHeapSize = Math.min(minUsedHeapSize, maxUsedHeapSize);\n\n    const lineWidth = 1;\n    const width = this.width();\n    const height = this.height() - lowerOffset;\n    const xFactor = width / (maxTime - minTime);\n    const yFactor = (height - lineWidth) / Math.max(maxUsedHeapSize - minUsedHeapSize, 1);\n\n    const histogram = new Array(width);\n\n    function buildHistogram(event: TraceEngine.Legacy.Event): void {\n      const counters = event.args.data;\n      if (!counters || !counters.jsHeapSizeUsed) {\n        return;\n      }\n      const x = Math.round((event.startTime - minTime) * xFactor);\n      const y = Math.round((counters.jsHeapSizeUsed - minUsedHeapSize) * yFactor);\n      // TODO(alph): use sum instead of max.\n      histogram[x] = Math.max(histogram[x] || 0, y);\n    }\n    for (let i = 0; i < trackEvents.length; i++) {\n      trackEvents[i].forEach(buildHistogram);\n    }\n\n    const ctx = this.context();\n    const heightBeyondView = height + lowerOffset + lineWidth;\n\n    ctx.translate(0.5, 0.5);\n    ctx.beginPath();\n    ctx.moveTo(-lineWidth, heightBeyondView);\n    let y = 0;\n    let isFirstPoint = true;\n    let lastX = 0;\n    for (let x = 0; x < histogram.length; x++) {\n      if (typeof histogram[x] === 'undefined') {\n        continue;\n      }\n      if (isFirstPoint) {\n        isFirstPoint = false;\n        y = histogram[x];\n        ctx.lineTo(-lineWidth, height - y);\n      }\n      const nextY = histogram[x];\n      if (Math.abs(nextY - y) > 2 && Math.abs(x - lastX) > 1) {\n        ctx.lineTo(x, height - y);\n      }\n      y = nextY;\n      ctx.lineTo(x, height - y);\n      lastX = x;\n    }\n    ctx.lineTo(width + lineWidth, height - y);\n    ctx.lineTo(width + lineWidth, heightBeyondView);\n    ctx.closePath();\n\n    ctx.fillStyle = 'hsla(220, 90%, 70%, 0.2)';\n    ctx.fill();\n    ctx.lineWidth = lineWidth;\n    ctx.strokeStyle = 'hsl(220, 90%, 70%)';\n    ctx.stroke();\n\n    this.heapSizeLabel.textContent = i18nString(UIStrings.sSDash, {\n      PH1: Platform.NumberUtilities.bytesToString(minUsedHeapSize),\n      PH2: Platform.NumberUtilities.bytesToString(maxUsedHeapSize),\n    });\n  }\n}\n\nexport class Quantizer {\n  private lastTime: number;\n  private quantDuration: number;\n  private readonly callback: (arg0: Array<number>) => void;\n  private counters: number[];\n  private remainder: number;\n  constructor(startTime: number, quantDuration: number, callback: (arg0: Array<number>) => void) {\n    this.lastTime = startTime;\n    this.quantDuration = quantDuration;\n    this.callback = callback;\n    this.counters = [];\n    this.remainder = quantDuration;\n  }\n\n  appendInterval(time: number, group: number): void {\n    let interval = time - this.lastTime;\n    if (interval <= this.remainder) {\n      this.counters[group] = (this.counters[group] || 0) + interval;\n      this.remainder -= interval;\n      this.lastTime = time;\n      return;\n    }\n    this.counters[group] = (this.counters[group] || 0) + this.remainder;\n    this.callback(this.counters);\n    interval -= this.remainder;\n    while (interval >= this.quantDuration) {\n      const counters = [];\n      counters[group] = this.quantDuration;\n      this.callback(counters);\n      interval -= this.quantDuration;\n    }\n    this.counters = [];\n    this.counters[group] = interval;\n    this.lastTime = time;\n    this.remainder = this.quantDuration - interval;\n  }\n}\n"]}